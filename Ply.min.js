/*! Ply 0.3.0 - MIT | git://github.com/rubaxa/Ply.git */
!function(a){window.Ply=a(window)}(function(a){"use strict";function b(a){return"function"==typeof a}function c(a){if(C)return new C(a);var b=B.Deferred();return a(b.resolve,b.reject),b}function d(a){return C?C.all(a):B.when.apply(B,a)}function e(a){return function(){setTimeout(a,1)}}function f(a,b){if(a)for(var c in a)a.hasOwnProperty(c)&&b(a[c],c,a)}function g(a){var c={};return f(a,function(a,d){c[d]=b(a)?a:a instanceof Object?g(a):a}),c}function h(a){for(var b=Array.prototype.slice,c=b.call(arguments,1),d=0,e=c.length;e>d;d++)f(c[d],function(b,c){a[c]=b});return a}function i(a,b){try{return(b||A).querySelector(a)}catch(c){return B(a,b)[0]}}function j(a,b){return a.getElementsByTagName(b)}function k(a,b){a&&b&&a.appendChild(b)}function l(a){a&&a.parentNode&&a.parentNode.removeChild(a)}function m(a,b,c){var d=c.handle=c.handle||function(b){b.target||(b.target=b.srcElement||A),3===b.target.nodeType&&(b.target=b.target.parentNode),b.preventDefault||(b.preventDefault=function(){b.returnValue=!1}),b.stopPropagation||(b.stopPropagation=function(){b.cancelBubble=!0}),c.call(a,b)};a.addEventListener?a.addEventListener(b,d,!1):a.attachEvent("on"+b,d)}function n(a,b,c){var d=c.handle;d&&(a.removeEventListener?a.removeEventListener(b,d,!1):a.detachEvent("on"+b,d))}function o(a,b,c){if(a&&a.style)if(b instanceof Object)for(var d in b)o(a,d,b[d]);else{if(void 0===c)return A.defaultView&&A.defaultView.getComputedStyle?c=A.defaultView.getComputedStyle(a,""):a.currentStyle&&(c=a.currentStyle),void 0===b?c:c[b];a.style[E[b]||b]=c}}function p(a){if(null==a&&(a="div"),a.appendChild)return a;if(a.skip)return A.createDocumentFragment();"string"==typeof a&&(a={tag:a});var b,c=a.children,d=D.exec(a.tag||"");return delete a.children,a.tag=d[1]||"div",a.id=a.id||(d[2]||"").substr(1),d=(d[3]||"").split("."),d[0]=a.className||"",a.className=d.join(" "),b=A.createElement(a.tag),delete a.tag,f(a,function(c,d){c&&("css"===d?o(b,a.css):"text"===d?null!=c&&k(b,A.createTextNode(c)):"html"===d?null!=c&&(b.innerHTML=c):"ply"===d?b.setAttribute(J,c):d in b?b[d]=c:/^data-/.test(d)&&b.setAttribute(d,c))}),c&&c.appendChild?k(b,c):f(c,function(a,c){a&&("string"==typeof a?a={text:a}:"object"!=typeof a&&(a={}),"string"==typeof c&&(a.tag=a.tag||c),k(b,p(a)))}),b}function q(a){for(var b,c,d=j(a,"input"),e=0,f=d.length;f>e;e++)if(b=d[e],"submit"===b.type)!c&&(c=b);else if(!/hidden|check|radio/.test(b.type)&&""==b.value){c=b;break}c||(c=j(a,"button")[0]);try{c.focus()}catch(g){}}function r(a){return s(!0),c(function(b){for(var c,d=j(a,"img"),e=d.length,f=e,g=function(){if(--f<=0){for(e=d.length;e--;)c=d[e],n(c,"load",g),n(c,"error",g);s(!1),b()}};e--;)c=d[e],c.complete?f--:(m(c,"load",g),m(c,"error",g));!f&&g()})}function s(a){var b=s.get();clearTimeout(s.pid),s.pid=a?setTimeout(function(){k(A.body,b)},100):setTimeout(function(){l(b)},100)}function t(a,b){var c=p({css:{padding:"20px 20px 40px",display:"inline-block",position:"relative",textAlign:"left",whiteSpace:"normal",verticalAlign:"middle",transform:"translate3d(0, 0, 0)"},children:a});return b&&o(a,b),o(a,{overflow:"hidden",position:"relative",backfaceVisibility:"hidden"}),c.setAttribute(J,"layer"),k(c,a),c}function u(a){var b=p();return a&&(o(b,a),o(b,{top:0,left:0,right:0,bottom:0,position:"fixed"}),b.setAttribute(J,"overlay")),b}function v(a,b,c){a.wrapEl=p({css:{whiteSpace:"nowrap"}}),c||(a.overlayEl=u(b.overlay),k(a.wrapEl,a.overlayEl));var d=p();o(d,{height:"100%",display:"inline-block",verticalAlign:"middle"}),k(a.wrapEl,d);var e=b.el;return a.el=e&&e.cloneNode?e.cloneNode(!0):p({html:e||""}),a.layerEl=t(a.el,b.layer),a.contentEl=a.layerEl.firstChild,a.context=new x(a.layerEl),k(a.wrapEl,a.layerEl),a.bodyEl=b.body&&i(b.body)||A.body,a.wrapEl.tabIndex=-1,o(a.wrapEl,{top:0,left:0,right:0,bottom:0,position:"fixed",textAlign:"center",overflow:"auto",outline:0}),a}function w(a){var b=this;b.cid="c"+y++,b.options=a=h({layer:K.layer,overlay:K.overlay,init:z,open:z,close:z,destroy:z,callback:z},a),a.flags=h({},K.flags,a.flags),v(b,a),b.setEffect(a.effect),b.fx={queue:c(function(a){a()})},b.fx.add=function(a){return!(b.fx.queue=b.fx.queue.then(a,a).then(function(){return b}))},b.on("click",":close",function(a,c){a.preventDefault(),b.closeBy("BUTTON"===c.nodeName?"cancel":"x")}),b.options.init(this)}function x(a){this.el=a}var y=1,z=function(){},A=a.document,B=a.jQuery||a.Zepto||a.ender||a.$,C=a.Promise,D=/^(\w+)?(#\w+)?((?:\.[\w_-]+)*)/i,E=function(){var a={},b=p().style,c="transition transform perspective transformStyle transformOrigin backfaceVisibility".split(" "),d=["Webkit","Moz","O","MS"];return f(c,function(c,e){if(a[c]=c in b&&c,!a[c])for(e=0;4>e;e++){var f=d[e]+c.charAt(0).toUpperCase()+c.substr(1);if(a[c]=f in b&&f)break}}),a}(),F={esc:27},G=[],H=G.push,I=G.splice,J="data-ply";s.get=function(){return s.el||(s.el=p({tag:".ply-loading",children:{".ply-loading-spinner":!0}}))};var K={layer:{},overlay:{opacity:.6,backgroundColor:"rgb(0, 0, 0)"},flags:{bodyScroll:!1,closeByEsc:!0,closeByOverlay:!0},lang:{ok:"OK",cancel:"Cancel"}};return w.fn=w.prototype={constructor:w,_activate:function(){if(!this.hasFlag("bodyScroll")){var a=this.bodyEl,b=p();a.__of=o(a,"overflow"),a.__pr=o(a,"paddingRight"),k(a,b),o(a,{overflow:"hidden",paddingRight:a.offsetWidth-b.offsetWidth+"px"}),l(b)}this.hasFlag("closeByOverlay")&&m(this.overlayEl,"click",this._getHandleEvent("overlay")),m(this.wrapEl,"submit",this._getHandleEvent("submit"))},_deactivate:function(){if(!this.hasFlag("bodyScroll")){var a=this.bodyEl;o(a,{overflow:a.__of,paddingRight:a.__pr})}n(this.layerEl,"submit",this._getHandleEvent("submit")),n(this.overlayEl,"click",this._getHandleEvent("overlay"))},_getHandleEvent:function(a){var b=this,c=b.__handleEvent||(b.__handleEvent={});return c[a]||(c[a]=function(c){b._handleEvent(a,c)}),c[a]},_handleEvent:function(a,b){b.preventDefault(),this.closeBy(a)},_applyEffect:function(a,b,c){return w.effects.apply.call(c||this.effects,a,b)},closeBy:function(a){var b=this.options.callback({by:a,state:"submit"===a,layer:this,context:this.context});b!==!1&&this.close()},on:function(a,b,c){var d=this;return c||(c=b,b="layer"),c["_"+b]=function(a){var e=a.target;do if(1===e.nodeType&&e.getAttribute(J)===b)return c.call(d,a,e);while(e!==d.wrapEl&&(e=e.parentNode))},m(d.wrapEl,a,c["_"+b]),d},off:function(a,b,c){return c||(c=b,b="layer"),n(this.wrapEl,a,c["_"+b]||z),this},hasFlag:function(a){return!!this.options.flags[a]},setEffect:function(a){return this.effects=w.effects.get(a),this},open:function(){var a=this;return a.visible||(a.visible=!0,a._activate(),w.stack.add(a),a.fx.add(function(){return r(a.wrapEl).then(function(){return k(a.bodyEl,a.wrapEl),a.wrapEl.focus(),a.wrapEl.focus(),q(a.layerEl),a.options.open(a),d([a._applyEffect(a.overlayEl,"open.overlay"),a._applyEffect(a.layerEl,"open.layer")])})})),a.fx.queue},close:function(){var a=this;return a.visible&&(a.visible=!1,a._deactivate(),w.stack.remove(a),a.fx.add(function(){return d([a._applyEffect(a.overlayEl,"close.overlay"),a._applyEffect(a.layerEl,"close.layer")]).then(function(){l(a.wrapEl),a.options.close(a)})})),a.fx.queue},_swap:function(a,b,c,e,f){var g=this;return g.visible?g.fx.add(function(){return r(b).then(function(){return e(),d([g._applyEffect(a,"close.layer",c),g._applyEffect(b,"open.layer",c)]).then(function(){l(a),f(),g.wrapEl.focus(),q(b)})})}):f(),g.fx.queue},swap:function(a,b){a.layer=a.layer||this.options.layer;var c=this,d=v({},a,!0),e=b||a.effect?w.effects.get(b||a.effect):c.effects,f=c.layerEl,g=d.layerEl;return c._swap(f,g,e,function(){k(c.bodyEl,c.wrapEl),k(c.bodyEl,d.wrapEl)},function(){l(d.wrapEl),k(c.wrapEl,g),c.el=d.el,c.layerEl=g,c.contentEl=g.firstChild,c.context.el=g})},innerSwap:function(a,b){a.layer=a.layer||this.options.layer;var c=this,d=v({},a,!0),e=b||a.effect?w.effects.get(b||a.effect):c.effects,f=i(".ply-inside",d.layerEl),g=i(".ply-inside",c.layerEl);return c._swap(g,f,e,function(){o(g,{width:g.offsetWidth+"px",position:"absolute"}),k(g.parentNode,f)},z)},destroy:function(){l(this.wrapEl),this.visible=!1,this._deactivate(),this.options.destroy(this)}},w.stack={_idx:{},last:null,length:0,_pop:function(a){var b=w.stack.last;a.keyCode===F.esc&&b.hasFlag("closeByEsc")&&b.closeBy("esc")},add:function(a){var b=H.call(this,a);this.last=a,this._idx[a.cid]=b-1,1===b&&m(A,"keyup",this._pop)},remove:function(a){var b=this._idx[a.cid];b>=0&&(I.call(this,b),delete this._idx[a.cid],this.last=this[this.length-1],this.last||n(A,"keyup",this._pop))}},w.effects={defaults:{duration:300,open:{layer:null,overlay:null},close:{layer:null,overlay:null}},setup:function(a){this.defaults=this.get(a)},get:function(a){function b(a){var b=/^([\w_-]+)(?::(\d+%?))?(\[[^\]]+\])?/.exec(a)||[];return{name:b[1]||a,duration:b[2]||null,args:JSON.parse(b[3]||"null")||{}}}function c(c,d,e){var f=b(d),g=c[f.name]||e||{},h=f.duration||g.duration||c.duration||a.duration;return"string"==typeof g&&(g=b(g),delete g.args),/%/.test(g.duration)&&(g.duration=parseInt(g.duration,10)/100*h),g.duration=0|(g.duration||h),g}var d=g(this.defaults);if("string"==typeof a){var e=b(a);a=g(this[e.name]||{open:{},close:{}}),a.duration=e.duration||a.duration,a.open.args=e.args[0],a.close.args=e.args[1]}else if(a instanceof Array){var f=b(a[0]),h=b(a[1]),i=this[f.name],j=this[h.name];a={open:g(i&&i.open||{layer:a[0],overlay:a[0]}),close:g(j&&j.close||{layer:a[1],overlay:a[1]})},a.open.args=f.args[0],a.close.args=h.args[0]}a=a||{},a.duration=0|(a.duration||d.duration);for(var k in{open:0,close:0}){var l=a[k]||d[k]||{};"string"==typeof l&&(l={layer:l}),l.layer=c(l,"layer",d[k].layer),l.overlay=c(l,"overlay",d[k].overlay),void 0===l.args&&delete l.args,a[k]=l}return a},apply:function(a,d){d=d.split(".");var h,i,j=this[d[0]],k=a.firstChild,l=[a.getAttribute("style"),k&&k.getAttribute("style")];return j&&(i=j[d[1]])&&(h=w.effects[i.name])&&(h.to||h.from)?(h=g(h),o(a,"transition","none"),o(k,"transition","none"),f(h.to,function(b,c,d){"&"===b&&(d[c]=o(a,c))}),b(h.from)?h.from(a,j.args):h.from&&o(a,h.from),c(function(c){h.width=a.offsetWidth,o(a,"transition","all "+i.duration+"ms"),o(k,"transition","all "+i.duration+"ms"),b(h.to)?h.to(a,j.args):o(a,h.to),setTimeout(c,i.duration)}).then(e(function(){a.setAttribute("style",l[0]),k&&k.setAttribute("style",l[1])}))):void 0},fade:{open:{layer:"fade-in:80%",overlay:"fade-in:100%"},close:{layer:"fade-out:60%",overlay:"fade-out:60%"}},scale:{open:{layer:"scale-in",overlay:"fade-in"},close:{layer:"scale-out",overlay:"fade-out"}},fall:{open:{layer:"fall-in",overlay:"fade-in"},close:{layer:"fall-out",overlay:"fade-out"}},slide:{open:{layer:"slide-in",overlay:"fade-in"},close:{layer:"slide-out",overlay:"fade-out"}},"3d-flip":{open:{layer:"3d-flip-in",overlay:"fade-in"},close:{layer:"3d-flip-out",overlay:"fade-out"}},"3d-sign":{open:{layer:"3d-sign-in",overlay:"fade-in"},close:{layer:"3d-sign-out",overlay:"fade-out"}},inner:{open:{layer:"inner-in"},close:{layer:"inner-out"}},"fade-in":{from:{opacity:0},to:{opacity:"&"}},"fade-out":{to:{opacity:0}},"slide-in":{from:{opacity:0,transform:"translateY(20%)"},to:{opacity:"&",transform:"translateY(0)"}},"slide-out":{to:{opacity:0,transform:"translateY(20%)"}},"fall-in":{from:{opacity:0,transform:"scale(1.3)"},to:{opacity:"&",transform:"scale(1)"}},"fall-out":{to:{opacity:0,transform:"scale(1.3)"}},"scale-in":{from:{opacity:0,transform:"scale(0.7)"},to:{opacity:"&",transform:"scale(1)"}},"scale-out":{to:{opacity:0,transform:"scale(0.7)"}},rotate3d:function(a,b,c,d,e){o(a,{perspective:"1300px"}),o(a.firstChild,{opacity:b,transform:"rotate"+c+"("+d+"deg)",transformStyle:"preserve-3d",transformOrigin:e?"50% 0":"50%"})},"3d-sign-in":{from:function(a){w.effects.rotate3d(a,0,"X",-60,"50% 0")},to:function(a){o(a.firstChild,{opacity:1,transform:"rotateX(0)"})}},"3d-sign-out":{from:function(a){w.effects.rotate3d(a,1,"X",0,"50% 0")},to:function(a){o(a.firstChild,{opacity:0,transform:"rotateX(-60deg)"})}},"3d-flip-in":{from:function(a,b){w.effects.rotate3d(a,0,"Y",b||-70)},to:function(a){o(a.firstChild,{opacity:1,transform:"rotateY(0)"})}},"3d-flip-out":{from:function(a){w.effects.rotate3d(a,1,"Y",0)},to:function(a,b){o(a.firstChild,{opacity:0,transform:"rotateY("+(b||70)+"deg)"})}},"inner-in":{from:function(a){o(a,"transform","translateX(100%)")},to:function(a){o(a,"transform","translateX(0%)")}},"inner-out":{from:function(a){o(a,"transform","translateX(0%)")},to:function(a){o(a,"transform","translateX(-100%)")}}},x.prototype={constructor:x,getEl:function(a){if(this.el)for(var b=j(this.el,"*"),c=b.length;c--;)if(b[c].getAttribute(J+"-name")===a)return b[c]},val:function(a,b){var c=this.getEl(a);return c&&null==c.value&&(c=j(c,"input")[0]||j(c,"textarea")[0]||j(c,"select")[0]),c&&null!=b&&(c.value=b),c&&c.value||""}},w.lang={ok:"OK",cancel:"Cancel"},w.css=o,w.keys=F,w.noop=z,w.each=f,w.extend=h,w.promise=c,w.defaults=K,w.attrName=J,w.Context=x,w.dom={build:p,appendChild:k,removeElement:l,addEvent:m,removeEvent:n},w});